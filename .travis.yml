language: c
sudo: false

env:
  global:
    # RACKET_DIR is an argument to install-racket.sh
    - RACKET_DIR=~/racket
    - PATH="$RACKET_DIR/bin:$PATH"
  matrix:
    - RACKET_VERSION=6.9 DEPLOY=true

cache:
  directories:
    - $HOME/.racket

before_install:
- curl -L https://raw.githubusercontent.com/greghendershott/travis-racket/master/install-racket.sh | bash
# - if $COV; then raco pkg install --deps search-auto doc-coverage cover cover-codecov; fi # or cover-coveralls

jobs:
  include:
    - stage: phase1
      install:
      - echo hello > ~/.racket/hello
      - echo "$TRAVIS_BUILD_ID" > ~/.racket/travis_build_id
      script:
      - ls -la $HOME
      - tree ~/.racket
    - stage: phase2
      addons:
        apt:
          packages:
          - texlive-latex-base
      install:
      - echo bye > ~/.racket/hello
      - cat ~/.racket/hello
      - if "$TRAVIS_BUILD_ID" != `cat ~/.racket/travis_build_id`; then travis_terminate 1; fi
      script:
      - ls -la $HOME
      - tree ~/.racket
      - mv ~/.racket ~/.racket-discard
      - mkdir ~/.racket # clear the cache
